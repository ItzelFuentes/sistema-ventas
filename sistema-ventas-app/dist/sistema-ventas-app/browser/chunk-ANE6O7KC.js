import{a as Re}from"./chunk-AUHFQVB7.js";import{a as w}from"./chunk-4AO5KPB3.js";import{A as le,B as ue,F as pe,G as ce,H as de,I as fe,J as he,K as ge,L as ve,M as _e,N as Ce,O as be,P as Ee,Q as Se,R,S as we,T as xe,U as De,V as ye,W as Ie,X as Me,Y as Ue,Z as Fe,a as K,b as F,e as X,f as Y,k as Z,l as f,m as ee,n as te,o as ie,p as re,q as oe,r as ae,s as ne,x as se,y as me}from"./chunk-TXPXS5KD.js";import{a as Q,b as J,m as j}from"./chunk-2WVB54ND.js";import"./chunk-IX6G3U3V.js";import{$a as h,$b as g,E as C,Eb as o,Fb as a,Gb as c,Hb as b,Ib as E,Kb as H,Nb as _,Pb as S,Pc as G,Qc as z,Sc as W,Tb as P,Ub as B,Vb as L,W as v,Zb as s,_a as m,_b as D,aa as A,ba as I,cc as q,fa as $,j as y,ka as M,la as U,q as V,qb as d,ta as N,ua as k,vb as p}from"./chunk-GK2P5D7S.js";var O=(()=>{let t=class t{constructor(i,r){this.snackBar=i,this.http=r}getHeaders(){let i=localStorage.getItem("jwt");return new Q({auth:`${i}`})}listarUsuarios(){return this.http.get(`${w.API_URL}/usuarios`,{headers:this.getHeaders()}).pipe(C(i=>this.handlerError(i)))}listarRoles(){return this.http.get(`${w.API_URL}/general/roles`,{headers:this.getHeaders()}).pipe(C(i=>this.handlerError(i)))}insertarUsuario(i){return this.http.post(`${w.API_URL}/usuarios`,i,{headers:this.getHeaders()}).pipe(C(r=>this.handlerError(r)))}actualizarUsuario(i){return this.http.put(`${w.API_URL}/usuarios`,i,{headers:this.getHeaders()}).pipe(C(r=>this.handlerError(r)))}eliminarUsuario(i){return this.http.delete(`${w.API_URL}/usuarios/${i}`,{headers:this.getHeaders()}).pipe(C(r=>this.handlerError(r)))}handlerError(i){console.log(i);let r="Ocurri\xF3 un error";return i.error&&(i.error.message?r=i.error.message:r="Ocurri\xF3 un error"),this.snackBar.open(r,"",{duration:3e3}),V(()=>new Error(r))}};t.\u0275fac=function(r){return new(r||t)($(X),$(J))},t.\u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Ae(e,t){if(e&1&&(o(0,"mat-option",14),s(1),a()),e&2){let l=t.$implicit;p("value",l.cveRol),m(),g(" ",l.descripcion+" - "+l.clave," ")}}function He(e,t){if(e&1&&(o(0,"mat-form-field",2)(1,"mat-label"),s(2,"Contrase\xF1a"),a(),c(3,"input",15),o(4,"mat-error"),s(5),a()()),e&2){let l=S();m(5),g(" ",l.baseForm.getErrorMessage(l.userForm.get("password"))," ")}}function Pe(e,t){if(e&1&&(o(0,"mat-form-field",2)(1,"mat-label"),s(2,"Repetir contrase\xF1a"),a(),c(3,"input",16),o(4,"mat-error"),s(5),a()()),e&2){let l=S();m(5),g(" ",l.baseForm.getErrorMessage(l.userForm.get("confirmPassword"))," ")}}var x=function(e){return e.EDIT="edit",e.NEW="new",e}(x||{}),Oe=(()=>{let t=class t{constructor(i,r,n,u,ke){this.data=i,this.dialogRef=r,this.fb=n,this.baseForm=u,this.usuarioSvc=ke,this.destroy$=new y,this.titleButton="Guardar",this.actionTODO=x.NEW,this.roles=[],this.userForm=this.fb.group({cveUsuario:[""],nombre:["",[f.required,f.minLength(3)]],apellidos:["",[f.required,f.minLength(3)]],username:["",[f.required,f.minLength(3)]],cveRol:["",[f.required]],password:["",[f.required]],confirmPassword:["",[f.required]]},{validator:this.checkPasswords})}ngOnInit(){this.usuarioSvc.listarRoles().pipe(v(this.destroy$)).subscribe(i=>{this.roles=i,this.pathData()})}pathData(){this.data.user.cveUsuario?(this.userForm.patchValue({cveUsuario:this.data?.user.cveUsuario,nombre:this.data?.user.nombre,apellidos:this.data?.user.apellidos,username:this.data?.user.username,cveRol:this.data?.user.cveRol}),this.userForm.get("username")?.disable(),this.userForm.get("password")?.setValidators(null),this.userForm.get("password")?.setErrors(null),this.userForm.get("confirmPassword")?.setValidators(null),this.userForm.get("confirmPassword")?.setErrors(null),this.userForm.updateValueAndValidity(),this.titleButton="Actualizar",this.actionTODO=x.EDIT):(this.titleButton="Guardar",this.actionTODO=x.NEW)}onSave(){if(!this.userForm.invalid){var i=this.userForm.getRawValue();if(this.actionTODO==x.NEW){var r={nombre:i.nombre,apellidos:i.apellidos,username:i.username,password:i.password,cveRol:parseInt(i.cveRol)};this.usuarioSvc.insertarUsuario(r).pipe(v(this.destroy$)).subscribe(u=>{this.dialogRef.close(u)})}else{var n={cveUsuario:parseInt(i.cveUsuario),nombre:i.nombre,apellidos:i.apellidos,cveRol:parseInt(i.cveRol)};this.usuarioSvc.actualizarUsuario(n).pipe(v(this.destroy$)).subscribe(u=>{this.dialogRef.close(u)})}}}onClear(){this.actionTODO===x.NEW?this.userForm.reset():this.userForm.patchValue({nombre:"",apellidos:""})}checkPasswords(i){let r=i.get("password")?.value,n=i.get("confirmPassword")?.value;return r===n?null:{notSame:!0}}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};t.\u0275fac=function(r){return new(r||t)(h(xe),h(we),h(ae),h(Re),h(O))},t.\u0275cmp=M({type:t,selectors:[["app-usuario-dialog"]],decls:39,vars:9,consts:[["mat-dialog-title",""],[3,"submit","formGroup"],["appearance","outline",1,"full-width"],["type","text","formControlName","nombre","matInput",""],["type","text","formControlName","apellidos","matInput",""],["type","text","formControlName","username","matInput",""],["formControlName","cveRol"],[3,"value",4,"ngFor","ngForOf"],["class","full-width","appearance","outline",4,"ngIf"],["align","center"],["type","button","mat-flat-button","","color","warn",1,"me-2",3,"click"],["type","submit","mat-flat-button","","color","primary"],["align","end"],["mat-button","","mat-dialog-close",""],[3,"value"],["type","password","formControlName","password","matInput",""],["type","password","formControlName","confirmPassword","matInput",""]],template:function(r,n){r&1&&(o(0,"h1",0),s(1,"Usuario"),a(),o(2,"mat-dialog-content")(3,"form",1),_("submit",function(){return n.onSave()}),o(4,"mat-form-field",2)(5,"mat-label"),s(6,"Nombre"),a(),c(7,"input",3),o(8,"mat-error"),s(9),a()(),o(10,"mat-form-field",2)(11,"mat-label"),s(12,"Apellidos"),a(),c(13,"input",4),o(14,"mat-error"),s(15),a()(),o(16,"mat-form-field",2)(17,"mat-label"),s(18,"Usuario"),a(),c(19,"input",5),o(20,"mat-error"),s(21),a()(),o(22,"mat-form-field",2)(23,"mat-label"),s(24,"Rol(es)"),a(),o(25,"mat-select",6),d(26,Ae,2,2,"mat-option",7),a(),o(27,"mat-error"),s(28),a()(),d(29,He,6,1,"mat-form-field",8)(30,Pe,6,1,"mat-form-field",8),o(31,"div",9)(32,"button",10),_("click",function(){return n.onClear()}),s(33," Limpiar "),a(),o(34,"button",11),s(35),a()()()(),o(36,"mat-dialog-actions",12)(37,"button",13),s(38," Cerrar "),a()()),r&2&&(m(3),p("formGroup",n.userForm),m(6),g(" ",n.baseForm.getErrorMessage(n.userForm.get("nombre"))," "),m(6),g(" ",n.baseForm.getErrorMessage(n.userForm.get("apellidos"))," "),m(6),g(" ",n.baseForm.getErrorMessage(n.userForm.get("username"))," "),m(5),p("ngForOf",n.roles),m(2),g(" ",n.baseForm.getErrorMessage(n.userForm.get("cveRol"))," "),m(),p("ngIf",n.actionTODO=="new"),m(),p("ngIf",n.actionTODO=="new"),m(5),g(" ",n.titleButton," "))},dependencies:[G,z,ie,Z,ee,te,re,oe,F,ue,le,se,me,ye,Ie,Ue,Me,Se,K]});let e=t;return e})();var Be=()=>[5,10,20,30,100];function Le(e,t){e&1&&(o(0,"th",16),s(1,"Nombre"),a())}function qe(e,t){if(e&1&&(o(0,"td",17),s(1),a()),e&2){let l=t.$implicit;m(),D(l.nombre)}}function Ge(e,t){e&1&&(o(0,"th",16),s(1,"Apellidos"),a())}function ze(e,t){if(e&1&&(o(0,"td",17),s(1),a()),e&2){let l=t.$implicit;m(),D(l.apellidos)}}function We(e,t){e&1&&(o(0,"th",16),s(1,"Usuario"),a())}function Qe(e,t){if(e&1&&(o(0,"td",17),s(1),a()),e&2){let l=t.$implicit;m(),D(l.username)}}function Je(e,t){e&1&&(o(0,"th",16),s(1,"Rol(es)"),a())}function Ke(e,t){if(e&1&&(o(0,"td",17),s(1),a()),e&2){let l=t.$implicit;m(),D(l.rol.descripcion)}}function Xe(e,t){e&1&&c(0,"th",16)}function Ye(e,t){if(e&1){let l=H();o(0,"td",18)(1,"button",19),_("click",function(){let r=N(l).$implicit,n=S();return k(n.onOpenModal(r))}),o(2,"mat-icon"),s(3,"edit"),a(),s(4," Editar "),a(),o(5,"button",20),_("click",function(){let r=N(l).$implicit,n=S();return k(n.onDelete(r.cveUsuario))}),o(6,"mat-icon"),s(7,"delete"),a(),s(8," Eliminar "),a()()}}function Ze(e,t){e&1&&c(0,"tr",21)}function et(e,t){e&1&&c(0,"tr",22)}var $e=(()=>{let t=class t{constructor(i,r){this.dialog=i,this.usuarioSvc=r,this.destroy$=new y,this.dataSource=new Ee,this.displayedColumns=["nombre","apellidos","username","rol","acciones"]}ngOnInit(){this.listar()}listar(){this.usuarioSvc.listarUsuarios().pipe(v(this.destroy$)).subscribe(i=>{this.dataSource.data=i})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onOpenModal(i={}){this.dialog.open(Oe,{maxWidth:"100%",width:"80%",data:{user:i}}).afterClosed().pipe(v(this.destroy$)).subscribe(n=>{n&&this.listar()})}onDelete(i){this.usuarioSvc.eliminarUsuario(i).pipe(v(this.destroy$)).subscribe(r=>{this.listar()})}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};t.\u0275fac=function(r){return new(r||t)(h(De),h(O))},t.\u0275cmp=M({type:t,selectors:[["app-usuarios"]],viewQuery:function(r,n){if(r&1&&P(R,5),r&2){let u;B(u=L())&&(n.paginator=u.first)}},decls:27,vars:5,consts:[[1,"m-3"],["align","right"],["mat-flat-button","","color","primary",1,"m-2",3,"click"],[1,"table-content","mat-elevation-z8","m-4"],["mat-table","",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","apellidos"],["matColumnDef","username"],["matColumnDef","rol"],["matColumnDef","acciones"],["mat-cell","","class","text-center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"text-center"],["mat-flat-button","","color","accent",1,"me-2",3,"click"],["mat-flat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(r,n){r&1&&(o(0,"h3",0),s(1,"Usuarios"),a(),o(2,"div",1)(3,"button",2),_("click",function(){return n.onOpenModal()}),o(4,"mat-icon"),s(5,"add"),a(),s(6," Agregar "),a()(),o(7,"div",3)(8,"table",4),b(9,5),d(10,Le,2,0,"th",6)(11,qe,2,1,"td",7),E(),b(12,8),d(13,Ge,2,0,"th",6)(14,ze,2,1,"td",7),E(),b(15,9),d(16,We,2,0,"th",6)(17,Qe,2,1,"td",7),E(),b(18,10),d(19,Je,2,0,"th",6)(20,Ke,2,1,"td",7),E(),b(21,11),d(22,Xe,1,0,"th",6)(23,Ye,9,0,"td",12),E(),d(24,Ze,1,0,"tr",13)(25,et,1,0,"tr",14),a(),c(26,"mat-paginator",15),a()),r&2&&(m(8),p("dataSource",n.dataSource),m(16),p("matHeaderRowDef",n.displayedColumns),m(),p("matRowDefColumns",n.displayedColumns),m(),p("pageSizeOptions",q(4,Be)))},dependencies:[F,Y,pe,de,ve,fe,ce,_e,he,ge,Ce,be,R]});let e=t;return e})();var tt=[{path:"",component:$e}],Ne=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=U({type:t}),t.\u0275inj=I({imports:[j.forChild(tt),j]});let e=t;return e})();var jt=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=U({type:t}),t.\u0275inj=I({imports:[W,Ne,ne,Fe]});let e=t;return e})();export{jt as UsuariosModule};
